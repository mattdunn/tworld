(function(t,p){(function(q){var e=t.simplegeo;if(e===p)e={};if(e.Client===p){e.Client=function(d,a){if(!(this instanceof e.Client))return new e.Client(d,a);a=a||{};this.token=d;this.options=a;this.host=a.host||"api.simplegeo.com";this.port=a.port||"80";this.apiUrl="http://"+this.host+":"+this.port;this.name="Client"};var n=t.navigator;e.Client.prototype={request:function(d,a,c){a.token=this.token;a=q.param(a)+"&callback=?";q.ajax({url:this.apiUrl+d,dataType:"json",data:a,success:function(g){if(g.error){var j=
Error(g.message);j.code=g.code;c(j)}else c(null,g.data)},error:function(g,j,u){c(u)}})},getFeature:function(d,a,c){if(c===p){c=a;a={}}return this.request("/1.0/features/"+d+".json",a,c)},watchLocationFromBrowser:function(d,a){if(a===p){a=d;d={}}n&&n.geolocation?n.geolocation.watchPosition(function(c){c.source="navigator";a(null,c)},function(c){a(c)},d):a(Error("navigator.geolocation not available"))},getLocationFromBrowser:function(d,a){if(a===p){a=d;d={}}n&&n.geolocation?n.geolocation.getCurrentPosition(function(c){c.source=
"navigator";a(null,c)},function(c){a(c)},d):a(Error("navigator.geolocation not available"))},getLocationFromIP:function(d,a){var c;if(a===p){a=d;c="/0.1/locate.json"}else c="/0.1/locate/"+d+".json";return this.request(c,{},function(g,j){g?a(g):a(null,{coords:{latitude:j.geometry.coordinates[1],longitude:j.geometry.coordinates[0],accuracy:1E5},timestamp:new Date,source:"simplegeo"})})},getLocation:function(d,a){var c=this;if(a===p){a=d;d={}}c.getLocationFromBrowser(d,function(g,j){g?c.getLocationFromIP(a):
a(null,j)})}}}e.PlacesClient=function(d,a){if(!(this instanceof e.PlacesClient))return new e.PlacesClient(d,a);e.Client.call(this,d,a);this.name="PlacesClient"};e.PlacesClient.prototype=new e.Client;e.PlacesClient.prototype.search=function(d,a,c,g){if(g===p){g=c;c={}}var j="/1.0/places/lat,lon.json";j=j.replace("lat",d).replace("lon",a);return this.request(j,c,g)};e.PlacesClient.prototype.searchFromIP=function(d,a,c){if(arguments.length===2){c=a;if(d.trim)a={};else{a=d;d="ip"}}else if(arguments.length===
1){c=d;d="ip";a={}}return this.request("/1.0/places/"+d+".json",a,c)};e.PlacesClient.prototype.searchFromAddress=function(d,a,c){if(c===p){c=a;a={}}a.address=d;return this.request("/1.0/places/address.json",a,c)};t.simplegeo=e})(function(q,e){var n=q.document,d=(new Date).getTime(),a=/=\?(&|$)/,c=/(\?|&)_=.*?(&|$)/,g=/\?/,j=/%20/g,u=Object.prototype.toString,o={isFunction:function(b){return u.call(b)==="[object Function]"},isArray:function(b){return u.call(b)==="[object Array]"},each:function(b,h,
k){var l,m=0,i=b.length,f=i===e||o.isFunction(b);if(k)if(f)for(l in b){if(h.apply(b[l],k)===false)break}else for(;m<i;){if(h.apply(b[m++],k)===false)break}else if(f)for(l in b){if(h.call(b[l],l,b[l])===false)break}else for(k=b[0];m<i&&h.call(k,m,k)!==false;k=b[++m]);return b},param:function(b){function h(i,f){if(o.isArray(f))o.each(f,function(s,r){/\[\]$/.test(i)?k(i,r):h(i+"["+(typeof r==="object"||o.isArray(r)?s:"")+"]",r)});else f!=null&&typeof f==="object"?o.each(f,function(s,r){h(i+"["+s+"]",
r)}):k(i,f)}function k(i,f){f=o.isFunction(f)?f():f;l[l.length]=encodeURIComponent(i)+"="+encodeURIComponent(f)}var l=[];if(o.isArray(b)||b.jquery)o.each(b,function(){k(this.name,this.value)});else for(var m in b)h(m,b[m]);return l.join("&").replace(j,"+")},ajax:function(b){var h,k;if(b.data&&typeof b.data!=="string")b.data=o.param(b.data);h=b.jsonpCallback||"jsonp"+d++;if(b.data)b.data=(b.data+"").replace(a,"="+h+"$1");b.url=b.url.replace(a,"="+h+"$1");q[h]=q[h]||function(s){k=s;b.success&&b.success.call(b,
k,void 0);b.complete&&b.complete.call(b,e,void 0);q[h]=e;try{delete q[h]}catch(r){}i&&i.removeChild(f)};var l=(new Date).getTime(),m=b.url.replace(c,"$1_="+l+"$2");b.url=m+(m===b.url?(g.test(b.url)?"&":"?")+"_="+l:"");b.url+=(g.test(b.url)?"&":"?")+b.data;var i=n.getElementsByTagName("head")[0]||n.documentElement,f=n.createElement("script");f.src=b.url;i.insertBefore(f,i.firstChild);return e}};return o}(t))})(window);
